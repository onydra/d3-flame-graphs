!function(t,e){if("function"==typeof define&&define.amd)define(["exports","d3-selection","d3-scale","d3-array","d3-transition","d3-tip","d3-hierarchy"],e);else if("undefined"!=typeof exports)e(exports,require("d3-selection"),require("d3-scale"),require("d3-array"),require("d3-transition"),require("d3-tip"),require("d3-hierarchy"));else{var n={exports:{}};e(n.exports,t.d3Selection,t.d3Scale,t.d3Array,t.d3Transition,t.d3Tip,t.d3Hierarchy),t.d3FlameGraph=n.exports}}(this,function(t,e,n,i,r,o,a){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var l=s(o),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},d=function(t){var e=void 0;return t?(e=t.split("."),e.slice(e.length-2).join(".")):""},f=function(t){var e=void 0,n=void 0,i=void 0,r=void 0,o=void 0,a=void 0,s=void 0,u=void 0;for(o=[0,0,1,10],s=o[0],i=o[1],u=o[2],r=o[3],t=d(t).slice(0,6),e=n=0,a=t.length-1;0<=a?n<=a:n>=a;e=0<=a?++n:--n)s+=u*(t.charCodeAt(e)%r),i+=u*(r-1),u*=.7;return i>0?s/i:s},v={augment:function(t,e){var n=t.children;if(t.augmented)return t;if(t.originalValue=t.value,t.level=t.children?1:0,t.hidden=[],t.location=e,!(null!=n?n.length:void 0))return t.augmented=!0,t;var i=n.reduce(function(t,e){return t+e.value},0);return i<t.value&&n.push({value:t.value-i,filler:!0}),n.forEach(function(t,n){return v.augment(t,e+"."+n)}),t.level+=n.reduce(function(t,e){return Math.max(e.level,t)},0),t.augmented=!0,t},partition:function(t){var e=(0,a.partition)(),n=(0,a.hierarchy)(t).sum(function(t){return t.data?t.data.value:t.value}).sort(function(t,e){return t.filler||t.data.filler?1:e.filler||t.data.filler?-1:t.data.name.localeCompare(e.data.name)});return e(n).descendants()},hide:function(t,e){null===e&&(e=!1);var n=function(t){return t.reduce(function(t,e){return t+e},0)},i=function(t,e){var n=t.indexOf(e);if(n>=0)return t.splice(n,1)},r=function(t,r){return e?i(t.hidden,r):t.hidden.push(r),t.value=Math.max(t.originalValue-n(t.hidden),0)},o=function s(t,e){if(t.children)return t.children.forEach(function(t){return r(t,e),s(t,e)})},a=function(t,e){for(var n=[];t.parent;)r(t.parent,e),n.push(t=t.parent);return n};return t.forEach(function(t){var e=t.originalValue;return a(t,e),r(t,e),o(t,e)})}},g=function(){function t(e,n,i){u(this,t),this._selector=e,this._generateAccessors(["margin","cellHeight","zoomEnabled","zoomAction","tooltip","tooltipPlugin","color","labelFunction"]),this._ancestors=[],null==i&&(i=!1),i?this.console=window.console:this.console={log:function(){},time:function(){},timeEnd:function(){}},this._size=[1200,800],this._cellHeight=20,this._margin={top:0,right:0,bottom:0,left:0},this._color=function(t){var e=f(t.data?t.data.name:t.name),n=200+Math.round(55*e),i=0+Math.round(230*(1-e)),r=0+Math.round(55*(1-e));return"rgb("+n+", "+i+", "+r+")"},this._labelFunction=null,this._tooltipEnabled=!0,this._zoomEnabled=!0,this._tooltipEnabled&&l["default"]&&(this._tooltipPlugin=(0,l["default"])()),this.console.time("augment"),this.original=v.augment(n,"0"),this.console.timeEnd("augment"),this.root(this.original)}return h(t,[{key:"size",value:function(t){return t?(this._size=t,(0,e.select)(this._selector).select(".flame-graph").attr("width",this._size[0]).attr("height",this._size[1]),this):this._size}},{key:"root",value:function(t){return t?(this.console.time("partition"),this._root=t,this._data=v.partition(this._root),this._rootNode=this._data[0],this.console.timeEnd("partition"),this):this._root}},{key:"hide",value:function(t,e){var n=void 0;if(null==e&&(e=!1),n=this.select(t,!1),n.length)return v.hide(n,e),this._data=v.partition(this._root),this.render()}},{key:"zoom",value:function(t,e){if(!this.zoomEnabled())throw new Error("Zoom is disabled!");return this.tip&&this.tip.hide(),c.call(this._ancestors,t)>=0?this._ancestors=this._ancestors.slice(0,this._ancestors.indexOf(t)):this._ancestors.push(this._root),this.root(t.data?t.data:t).render(),"function"==typeof this._zoomAction&&this._zoomAction(t,e),this}},{key:"width",value:function(){return this.size()[0]-(this.margin().left+this.margin().right)}},{key:"height",value:function(){return this.size()[1]-(this.margin().top+this.margin().bottom)}},{key:"label",value:function r(t){if(!(null!=t?t.data.name:void 0))return"";var r="function"==typeof this._labelFunction?this._labelFunction(t):d(t.data.name);return r.substr(0,Math.round(this.x(t.x1-t.x0)/(this.cellHeight()/10*4)))}},{key:"select",value:function(t,e){var n=void 0;return null==e&&(e=!0),e?this.container.selectAll(".node").filter(t):n=v.partition(this.original).filter(t)}},{key:"render",value:function(){if(!this._selector)throw new Error("No DOM element provided");this.console.time("render"),this.container||this._createContainer(),this.fontSize=this.cellHeight()/10*.4,this.x=(0,n.scaleLinear)().domain([0,(0,i.max)(this._data,function(t){return t.x1})]).range([0,this.width()]);var t=Math.floor(this.height()/this.cellHeight()),e=this._root.level;this.y=(0,n.scaleQuantize)().domain([(0,i.min)(this._data,function(t){return t.y0}),(0,i.max)(this._data,function(t){return t.y0})]).range((0,i.range)(e).map(function(e){return function(n){return(t-1-n-e._ancestors.length)*e.cellHeight()}}(this)));var r=this._data.filter(function(t){return function(e){return t.x(e.x1-e.x0)>.4&&t.y(e.y0)>=0&&!e.data.filler}}(this)),o={x:function(t){return function(e){return t.x(e.x0)}}(this),y:function(t){return function(e){return t.y(e.y0)}}(this),width:function(t){return function(e){var n=t.x(e.x1-e.x0);return n}}(this),height:function(t){return function(e){return t.cellHeight()}}(this),text:function(t){return function(e){if(e.data.name&&t.x(e.x1-e.x0)>40)return t.label(e)}}(this)},a=this.container.selectAll(".node").data(r,function(t){return t.data.location}).attr("class","node");this._renderNodes(a,o,!1,r);var s=a.enter().append("g").attr("class","node");return this._renderNodes(s,o,!0,r),a.exit().remove(),this.zoomEnabled()&&this._renderAncestors()._enableNavigation(),this.tooltip()&&this._renderTooltip(),this.console.timeEnd("render"),this.console.log("Processed "+this._data.length+" items"),this}},{key:"_createContainer",value:function(){(0,e.select)(this._selector).select("svg").remove();var t=(0,e.select)(this._selector).append("svg").attr("class","flame-graph").attr("width",this._size[0]).attr("height",this._size[1]),n="translate("+this.margin().left+", "+this.margin().top+")";return this.container=t.append("g").attr("transform",n),t.append("rect").attr("width",this._size[0]-(this._margin.left+this._margin.right)).attr("height",this._size[1]-(this._margin.top+this._margin.bottom)).attr("transform",n).attr("class","border-rect")}},{key:"_renderNodes",value:function(t,e,n,i){var r=void 0,o=void 0;return null==n&&(n=!1),n||(o=t.selectAll("rect")),n&&(o=t.append("rect")),o.data(i,function(t){return t.data?t.data.location:t.location}).attr("fill",function(t){return function(e){return t._color(e)}}(this)).transition().attr("width",e.width).attr("height",this.cellHeight()).attr("x",e.x).attr("y",e.y),n||(r=t.selectAll("text")),n&&(r=t.append("text")),r.data(i,function(t){return t.data?t.data.location:t.location}).attr("class","label").style("font-size",this.fontSize+"em").transition().attr("dy",this.fontSize/2+"em").attr("x",function(t){return function(t){return e.x(t)+2}}(this)).attr("y",function(t){return function(n,i){return e.y(n,i)+t.cellHeight()/2}}(this)).text(e.text),this}},{key:"_renderTooltip",value:function(){return this._tooltipPlugin&&this._tooltipEnabled?(this.tip=this._tooltipPlugin.attr("class","d3-tip").html(this.tooltip()).direction(function(t){return function(e){return t.x(e.x0)+t.x(e.x1-e.x0)/2>t.width()-100?"w":t.x(e.x0)+t.x(e.x1-e.x0)/2<100?"e":"s"}}(this)).offset(function(t){return function(e){var n=t.x(e.x0)+t.x(e.x1-e.x0)/2,i=Math.max(Math.ceil(t.x(e.x1-e.x0)/2),5),r=Math.ceil(t.cellHeight()/2);return t.width()-100<n?[0,-i]:n<100?[0,i]:[r,0]}}(this)),this.container.call(this.tip),this.container.selectAll(".node").on("mouseover",function(t){return function(n){return t.tip.show(n,e.event.currentTarget)}}(this)).on("mouseout",this.tip.hide).selectAll(".label").on("mouseover",function(t){return function(n){return t.tip.show(n,e.event.currentTarget.parentNode)}}(this)).on("mouseout",this.tip.hide),this):this}},{key:"_renderAncestors",value:function(){var t=void 0,e=void 0,n=void 0,i=void 0,r=void 0;if(!this._ancestors.length)return r=this.container.selectAll(".ancestor").remove(),this;var o=this._ancestors.map(function(t,e){return{name:t.name,value:e+1,location:t.location,isAncestor:!0}});for(e=t=0,n=o.length;t<n;e=++t){i=o[e];var a=o[e-1];a&&(a.children=[i])}var s={x:function(t){return function(t){return 0}}(this),y:function(t){return function(e){return t.height()-e.value*t.cellHeight()}}(this),width:this.width(),height:this.cellHeight(),text:function(t){return function(t){return"â†© "+d(t.data?t.data.name:t.name)}}(this)};r=this.container.selectAll(".ancestor").data(v.partition(o[0]),function(t){return t.location}),this._renderNodes(r,s,!1,o);var u=r.enter().append("g").attr("class","ancestor");return this._renderNodes(u,s,!0,o),r.exit().remove(),this}},{key:"_enableNavigation",value:function(){var t=function(t){return function(e){var n=void 0;return Math.round(t.width()-t.x(e.x1-e.x0))>0&&(null!=(n=e.children)?n.length:void 0)}}(this);return this.container.selectAll(".node").classed("clickable",function(e){return function(e){return t(e)}}(this)).on("click",function(n){return function(i){if(n.tip&&n.tip.hide(),t(i))return n.zoom(i,e.event)}}(this)),this.container.selectAll(".ancestor").on("click",function(t){return function(n,i){return t.tip&&t.tip.hide(),t.zoom(t._ancestors[i],e.event)}}(this)),this}},{key:"_generateAccessors",value:function(t){for(var e=void 0,n=[],i=0,r=t.length;i<r;i++)e=t[i],n.push(this[e]=function(t){return function(e){return arguments.length?(this["_"+t]=e,this):this["_"+t]}}(e));return n}}]),t}();t["default"]=g});